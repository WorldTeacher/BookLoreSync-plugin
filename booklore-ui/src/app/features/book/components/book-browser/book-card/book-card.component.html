<div class="book-card"
     [class.selected]="isSelected"
     (click)="onCardClick($event)">

  <div class="cover-container" [ngClass]="{ 'center-info-btn': _isSeriesViewActive, 'loaded': isImageLoaded }">
    <img
      [src]="coverImageUrl"
      class="book-cover"
      [class.loaded]="isImageLoaded"
      [alt]="'Cover of ' + displayTitle"
      loading="lazy"
      decoding="async"
      (load)="onImageLoad()"/>

    <div class="top-left-overlay-stack">
      @if (showBookTypePill && book.bookType) {
        <div class="book-type-pill-overlay" [ngClass]="'book-type-' + book.bookType.toLowerCase()">
          {{ book.bookType }}
        </div>
      }
      @if (!book.seriesCount && book.metadata?.seriesNumber != null) {
        <div class="series-number-overlay">
          #{{ book.metadata?.seriesNumber }}
        </div>
      }
      @if (book.seriesCount && book.seriesCount >= 1) {
        <div class="series-items-count-overlay">
          <i class="pi pi-book series-items-count-icon"></i>{{ book.seriesCount }}
        </div>
      }
    </div>

    @if (_isSeriesViewActive) {
      <p-button [rounded]="true" icon="pi pi-info" class="info-btn" (click)="openSeriesInfo()"></p-button>
    } @else {
      <p-button [rounded]="true" icon="pi pi-info" class="info-btn" (click)="openBookInfo(book)"></p-button>
    }

    @if (!_isSeriesViewActive) {
      <p-button [rounded]="true" icon="pi pi-book" class="read-btn" (click)="readBook(book)"></p-button>
    }

    @if (isCheckboxEnabled) {
      <p-checkbox
        [binary]="true"
        class="select-checkbox"
        (click)="captureMouseEvent($event)"
        [ngModel]="isSelected"
        (onChange)="toggleSelection($event)">
      </p-checkbox>
    }

    @if (hasProgress) {
      <div class="cover-progress-bar-container">
        @if (_progressPercentage !== null) {
          <p-progressBar
            [value]="_progressPercentage"
            [showValue]="false"
            class="cover-progress-bar"
            [ngClass]="{ 'progress-complete': _progressPercentage === 100, 'progress-incomplete': _progressPercentage < 100 }">
          </p-progressBar>
        }
        @if (_koProgressPercentage !== null) {
          <p-progressBar
            [value]="_koProgressPercentage"
            [showValue]="false"
            class="cover-progress-bar"
            [ngClass]="_koProgressPercentage === 100 ? 'progress-complete-ko' : 'progress-incomplete-ko'">
          </p-progressBar>
        }
        @if (_koboProgressPercentage !== null) {
          <p-progressBar
            [value]="_koboProgressPercentage"
            [showValue]="false"
            class="cover-progress-bar"
            [ngClass]="_koboProgressPercentage === 100 ? 'progress-complete-kobo' : 'progress-incomplete-kobo'">
          </p-progressBar>
        }
      </div>
    }
  </div>

  @if (!bottomBarHidden) {
    <div class="book-title-container flex items-center">
      @if (_shouldShowStatusIcon) {
        <div class="read-status-indicator"
             [ngClass]="_readStatusClass"
             [pTooltip]="readStatusTooltip"
             tooltipPosition="bottom">
          <i [class]="_readStatusIcon" style="font-size: 0.9rem"></i>
        </div>
      }
      <h4 class="book-title m-0 pl-2"
          tooltipPosition="bottom"
          [pTooltip]="titleTooltip">
        {{ displayTitle }}
      </h4>
      <p-tieredmenu #menu [model]="items" [popup]="true" appendTo="body" (onShow)="onMenuShow()" (onHide)="onMenuHide()"></p-tieredmenu>
      <p-button
        class="custom-button-padding"
        size="small"
        [text]="true"
        (click)="onMenuToggle($event, menu)"
        icon="pi pi-ellipsis-v">
      </p-button>
    </div>
  }
</div>
