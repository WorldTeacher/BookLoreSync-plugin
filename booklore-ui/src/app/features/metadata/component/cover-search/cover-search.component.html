<div class="cover-search-container">
  <div class="panel-header">
    <div class="header-icon-wrapper">
      <i class="pi {{ coverType === 'audiobook' ? 'pi-headphones' : 'pi-image' }} header-icon"></i>
    </div>
    <div class="header-text">
      <h2 class="panel-title">Search {{ coverType === 'audiobook' ? 'Audiobook' : 'Ebook' }} Cover</h2>
      <p class="panel-description">Find and select a cover for your book</p>
    </div>
    <p-button
      icon="pi pi-times"
      [rounded]="true"
      [text]="true"
      severity="secondary"
      (click)="dynamicDialogRef.close()"
      class="close-button">
    </p-button>
  </div>

  <div class="dialog-content">
    <!-- Search Form -->
    <div class="search-section">
      <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
        <div class="form-row">
          <div class="form-field title-field">
            <label for="title">
              <i class="pi pi-book"></i>
              Title
              <span class="required">*</span>
            </label>
            <input
              pInputText
              id="title"
              formControlName="title"
              placeholder="Enter book title"
            />
            @if (searchForm.get('title')?.invalid && searchForm.get('title')?.touched) {
              <small class="error-message">
                <i class="pi pi-exclamation-circle"></i>
                Title is required
              </small>
            }
          </div>

          <div class="form-field author-field">
            <label for="author">
              <i class="pi pi-user"></i>
              Author
            </label>
            <input
              pInputText
              id="author"
              formControlName="author"
              placeholder="Enter author name (optional)"
            />
          </div>

          <div class="form-actions">
            <p-button
              type="submit"
              label="Search"
              icon="pi pi-search"
              [loading]="loading"
              [disabled]="searchForm.invalid">
            </p-button>
            <p-button
              type="button"
              icon="pi pi-refresh"
              [text]="true"
              [rounded]="true"
              severity="secondary"
              (click)="onClear()"
              pTooltip="Reset search"
              tooltipPosition="top">
            </p-button>
          </div>
        </div>
      </form>
    </div>

    <!-- Results Area -->
    <div class="results-section">
      @if (!hasSearched) {
        <!-- Initial State -->
        <div class="empty-state">
          <div class="empty-state-icon">
            <i class="pi pi-images"></i>
          </div>
          <h3>Search for Book Covers</h3>
          <p>Enter a book title above to find cover images from various sources.</p>
        </div>
      } @else if (loading) {
        <!-- Loading State -->
        <div class="loading-state">
          <p-progressSpinner strokeWidth="3" animationDuration="1s"></p-progressSpinner>
          <p>Searching for covers...</p>
        </div>
      } @else if (coverImages.length === 0) {
        <!-- No Results State -->
        <div class="empty-state no-results">
          <div class="empty-state-icon warning">
            <i class="pi pi-search"></i>
          </div>
          <h3>No Covers Found</h3>
          <p>Try adjusting your search terms or check the spelling.</p>
        </div>
      } @else {
        <!-- Results Grid -->
        <div class="results-header">
          <span class="results-count">
            <i class="pi pi-images"></i>
            {{ coverImages.length }} cover{{ coverImages.length !== 1 ? 's' : '' }} found
          </span>
          <span class="results-hint">
            <i class="pi pi-info-circle"></i>
            Click on an image to preview, or select to apply
          </span>
        </div>

        <div class="covers-grid">
          @for (cover of coverImages; track cover.url; let i = $index) {
            <div class="cover-card">
              <div class="cover-image-wrapper">
                <p-image
                  [src]="cover.url"
                  [alt]="'Book cover ' + (i + 1)"
                  appendTo="body"
                  [preview]="true">
                </p-image>
                @if (cover.width && cover.height) {
                  <div class="resolution-badge">
                    {{ cover.width }} x {{ cover.height }}
                  </div>
                }
                <div class="cover-overlay">
                  <p-button
                    (click)="selectAndSave(cover)"
                    label="Select Cover"
                    icon="pi pi-check"
                    size="small">
                  </p-button>
                </div>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
