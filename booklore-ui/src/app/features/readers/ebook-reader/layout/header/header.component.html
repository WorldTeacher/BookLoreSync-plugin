<div class="reader-header" [class.visible]="isVisible" [style.background]="currentTheme.bg" [style.color]="currentTheme.fg">
  <div class="header-left">
    <button class="icon-btn" (click)="onShowChapters()" title="Chapters">
      <app-reader-icon name="menu" [size]="20"></app-reader-icon>
    </button>
    <button class="icon-btn" (click)="onCreateBookmark()" [title]="isCurrentCfiBookmarked ? 'Remove Bookmark' : 'Add Bookmark'" [class.active]="isCurrentCfiBookmarked">
      <app-reader-icon name="bookmark"></app-reader-icon>
    </button>
    <button class="icon-btn" (click)="onOpenSearch()" title="Search">
      <app-reader-icon name="search"></app-reader-icon>
    </button>
  </div>
  <span class="chapter-title">{{ bookTitle }}</span>
  <div class="header-right">
    <button class="icon-btn desktop-only" (click)="onOpenNotes()" title="Notes">
      <app-reader-icon name="note"></app-reader-icon>
    </button>
    <button class="icon-btn desktop-only" (click)="onToggleFullscreen()" [title]="isFullscreen ? 'Exit Fullscreen' : 'Fullscreen'">
      <app-reader-icon [name]="isFullscreen ? 'fullscreen-exit' : 'fullscreen'" [size]="20"></app-reader-icon>
    </button>
    <button class="icon-btn desktop-only" (click)="onShowHelp()" title="Keyboard Shortcuts">
      <app-reader-icon name="help" [size]="20"></app-reader-icon>
    </button>
    <div class="overflow-menu mobile-only">
      <button class="icon-btn" (click)="overflowOpen = !overflowOpen; $event.stopPropagation()" title="More">
        <app-reader-icon name="dots-vertical" [size]="20"></app-reader-icon>
      </button>
      @if (overflowOpen) {
        <div class="overflow-backdrop" (click)="overflowOpen = false"></div>
        <div class="overflow-dropdown" [style.background]="currentTheme.bg" [style.color]="currentTheme.fg">
          <button class="overflow-item" (click)="onOpenNotes(); overflowOpen = false">
            <app-reader-icon name="note" [size]="18"></app-reader-icon>
            <span>Notes</span>
          </button>
          <button class="overflow-item" (click)="onToggleFullscreen(); overflowOpen = false">
            <app-reader-icon [name]="isFullscreen ? 'fullscreen-exit' : 'fullscreen'" [size]="18"></app-reader-icon>
            <span>{{ isFullscreen ? 'Exit Fullscreen' : 'Fullscreen' }}</span>
          </button>
          <button class="overflow-item" (click)="onShowHelp(); overflowOpen = false">
            <app-reader-icon name="help" [size]="18"></app-reader-icon>
            <span>Keyboard Shortcuts</span>
          </button>
        </div>
      }
    </div>
    <button class="icon-btn" (click)="onShowControls()" title="Settings">
      <app-reader-icon name="settings"></app-reader-icon>
    </button>
    <button class="icon-btn close-btn" (click)="onClose(); $event.stopPropagation()" title="Close Reader">
      <app-reader-icon name="close"></app-reader-icon>
    </button>
  </div>
</div>
