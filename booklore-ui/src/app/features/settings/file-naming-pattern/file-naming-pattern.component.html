<ng-container *transloco="let t; prefix: 'settingsNaming'">
<div class="file-naming-container">
  <div class="settings-header">
    <h2 class="settings-title">
      <i class="pi pi-file"></i>
      {{ t('title') }}
      <app-external-doc-link docType="fileNamePatterns"></app-external-doc-link>
    </h2>
    <p class="settings-description">
      {{ t('description') }}
    </p>
  </div>

  <div class="warning-notice">
    <i class="pi pi-exclamation-triangle"></i>
    <div>
      <strong>{{ t('warning.title') }}</strong> {{ t('warning.text') }}
    </div>
  </div>

  <div class="settings-card">
    <div class="section-header">
      <h3 class="section-title">
        <i class="pi pi-bolt"></i>
        {{ t('defaultPattern.sectionTitle') }}
      </h3>
      <p class="section-description">{{ t('defaultPattern.sectionDesc') }}</p>
    </div>

    <div class="section-body">
      <div class="default-pattern-card">
        <div class="pattern-input-container">
          <div class="pattern-input-row">
            <input
              pInputText
              id="defaultPattern"
              [(ngModel)]="defaultPattern"
              [placeholder]="t('defaultPattern.placeholder')"
              (input)="onDefaultPatternChange(defaultPattern)"
              class="pattern-input"/>
            <p-button
              [label]="'common.save' | transloco"
              icon="pi pi-save"
              (onClick)="savePatterns()"
              severity="success"
              [outlined]="true"
              [disabled]="!!defaultErrorMessage">
            </p-button>
          </div>
          @if (defaultErrorMessage) {
            <span class="error-text">{{ defaultErrorMessage }}</span>
          }
          <div class="preview-row">
            <span class="preview-label">
              <i class="pi pi-eye"></i>
              {{ t('defaultPattern.preview') }}
            </span>
            <code class="preview-value">{{ generateDefaultPreview() }}</code>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="settings-card">
    <div class="section-header">
      <h3 class="section-title">
        <i class="pi pi-folder"></i>
        {{ t('libraryOverrides.sectionTitle') }}
      </h3>
      <p class="section-description">
        {{ t('libraryOverrides.sectionDesc') }}
      </p>
    </div>

    <div class="section-body">
      @if (libraries.length === 0) {
        <div class="empty-state">
          <i class="pi pi-folder-open"></i>
          <p class="empty-title">{{ t('libraryOverrides.emptyTitle') }}</p>
          <p class="empty-subtitle">{{ t('libraryOverrides.emptySubtitle') }}</p>
        </div>
      } @else {
        <div class="libraries-list">
          @for (library of libraries; track library.id) {
            <div class="library-item" [class.has-pattern]="library.fileNamingPattern">
              <div class="library-header">
                <div class="library-info">
                  <div class="library-icon">
                    <i [class]="'pi pi-' + library.icon"></i>
                  </div>
                  <span class="library-name">{{ library.name }}</span>
                  @if (library.fileNamingPattern) {
                    <span class="custom-badge">{{ t('libraryOverrides.custom') }}</span>
                  } @else {
                    <span class="default-badge">{{ t('libraryOverrides.usingDefault') }}</span>
                  }
                </div>
                <p-button
                  icon="pi pi-times"
                  severity="secondary"
                  size="small"
                  [outlined]="true"
                  [rounded]="true"
                  (onClick)="clearLibraryPattern(library)"
                  [disabled]="!library.fileNamingPattern"
                  [pTooltip]="t('libraryOverrides.clearPattern')">
                </p-button>
              </div>
              <div class="library-body">
                <div class="pattern-input-container">
                  <input
                    pInputText
                    [(ngModel)]="library.fileNamingPattern"
                    [placeholder]="t('libraryOverrides.placeholder')"
                    (input)="onLibraryPatternChange(library)"
                    class="pattern-input"/>
                  <div class="preview-row">
                    <span class="preview-label">
                      <i class="pi pi-eye"></i>
                      {{ t('libraryOverrides.preview') }}
                    </span>
                    <code class="preview-value">{{ generateLibraryPreview(library) }}</code>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>

        <div class="actions-row">
          <p-button
            [label]="t('libraryOverrides.saveAll')"
            (onClick)="saveLibraryPatterns()"
            severity="success"
            icon="pi pi-save"
            [outlined]="true">
          </p-button>
        </div>
      }
    </div>
  </div>

  <div class="settings-card">
    <div class="section-header">
      <h3 class="section-title">
        <i class="pi pi-info-circle"></i>
        {{ t('placeholders.sectionTitle') }}
      </h3>
      <p class="section-description">
        {{ t('placeholders.sectionDesc') }}
      </p>
    </div>

    <div class="section-body">
      <div class="placeholders-grid">
        <div class="placeholder-group">
          <h4 class="group-title">
            <i class="pi pi-hashtag"></i>
            {{ t('placeholders.available') }}
          </h4>
          <div class="placeholder-list">
            <div class="placeholder-item"><code>{{ '{title}' }}</code><span>{{ t('placeholders.title') }}</span></div>
            <div class="placeholder-item"><code>{{ '{subtitle}' }}</code><span>{{ t('placeholders.subtitle') }}</span></div>
            <div class="placeholder-item"><code>{{ '{authors}' }}</code><span>{{ t('placeholders.authors') }}</span></div>
            <div class="placeholder-item"><code>{{ '{year}' }}</code><span>{{ t('placeholders.year') }}</span></div>
            <div class="placeholder-item"><code>{{ '{series}' }}</code><span>{{ t('placeholders.series') }}</span></div>
            <div class="placeholder-item"><code>{{ '{seriesIndex}' }}</code><span>{{ t('placeholders.seriesIndex') }}</span></div>
            <div class="placeholder-item"><code>{{ '{language}' }}</code><span>{{ t('placeholders.language') }}</span></div>
            <div class="placeholder-item"><code>{{ '{publisher}' }}</code><span>{{ t('placeholders.publisher') }}</span></div>
            <div class="placeholder-item"><code>{{ '{isbn}' }}</code><span>{{ t('placeholders.isbn') }}</span></div>
            <div class="placeholder-item"><code>{{ '{currentFilename}' }}</code><span>{{ t('placeholders.currentFilename') }}</span></div>
          </div>
        </div>

        <div class="placeholder-group">
          <h4 class="group-title">
            <i class="pi pi-code"></i>
            {{ t('placeholders.optionalBlocks') }}
          </h4>
          <p class="group-description" [innerHTML]="t('placeholders.optionalDesc', { syntax: '{<...>}' })">
          </p>
          <div class="example-block">
            <div class="example-pattern">
              <span class="pattern-prefix">{{ t('placeholders.pattern') }}</span>
              <code>{{ '{<{seriesIndex} - >{title}' }}</code>
            </div>
            <div class="example-results">
              <div class="result-item">
                <span class="result-prefix">{{ t('placeholders.withIndex') }}</span>
                <code>01 - Dune</code>
              </div>
              <div class="result-item">
                <span class="result-prefix">{{ t('placeholders.without') }}</span>
                <code>Dune</code>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="settings-card">
    <div class="section-header">
      <h3 class="section-title">
        <i class="pi pi-eye"></i>
        {{ t('examples.sectionTitle') }}
      </h3>
      <p class="section-description">
        {{ t('examples.sectionDesc') }}
      </p>
    </div>

    <div class="section-body">
      <div class="examples-container">
        <div class="example-category">
          <div class="category-header">
            <h4 class="category-title">
              <i class="pi pi-check-circle"></i>
              {{ t('examples.withFull') }}
            </h4>
            <div class="sample-metadata">
              <div class="metadata-items">
                <span><strong>title:</strong> <code>The Name of the Wind</code></span>
                <span><strong>subtitle:</strong> <code>Special Edition</code></span>
                <span><strong>authors:</strong> <code>Patrick Rothfuss</code></span>
                <span><strong>series:</strong> <code>The Kingkiller Chronicle</code></span>
                <span><strong>seriesIndex:</strong> <code>01</code></span>
                <span><strong>year:</strong> <code>2007</code></span>
              </div>
            </div>
          </div>

          <div class="example-grid">
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.basicPattern') }}</span>
              <span class="pattern-col"><code>{{ '{authors} - {title}' }}</code></span>
              <span class="result-col"><code>Patrick Rothfuss - The Name of the Wind.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.withPunctuation') }}</span>
              <span class="pattern-col"><code>{{ '{title}: {series}' }}</code></span>
              <span class="result-col"><code>The Name of the Wind: The Kingkiller Chronicle.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.seriesInFolder') }}</span>
              <span class="pattern-col"><code>{{ '{authors}/{series}/{seriesIndex} - {title}' }}</code></span>
              <span class="result-col"><code>Patrick Rothfuss/The Kingkiller Chronicle/01 - The Name of the Wind.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.folderOnly') }}</span>
              <span class="pattern-col"><code>{{ '{title}/' }}</code></span>
              <span class="result-col"><code>The Name of the Wind/name_of_the_wind_original.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.absolutePath') }}</span>
              <span class="pattern-col"><code>{{ '/{authors}/{title}' }}</code></span>
              <span class="result-col"><code>/Patrick Rothfuss/The Name of the Wind.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.titleSubtitle') }}</span>
              <span class="pattern-col"><code>{{ '{title}: {subtitle}' }}</code></span>
              <span class="result-col"><code>The Name of the Wind: Special Edition.epub</code></span>
            </div>
          </div>
        </div>

        <div class="section-divider"><hr></div>

        <div class="example-category">
          <div class="category-header">
            <h4 class="category-title">
              <i class="pi pi-question-circle"></i>
              {{ t('examples.withMissing') }}
            </h4>
            <div class="sample-metadata">
              <div class="metadata-items">
                <span><strong>title:</strong> <code>Project Hail Mary</code></span>
                <span><strong>subtitle:</strong> <em class="not-set">{{ t('examples.notSet') }}</em></span>
                <span><strong>authors:</strong> <code>Andy Weir</code></span>
                <span><strong>year:</strong> <code>2021</code></span>
                <span><strong>series:</strong> <em class="not-set">{{ t('examples.notSet') }}</em></span>
                <span><strong>seriesIndex:</strong> <em class="not-set">{{ t('examples.notSet') }}</em></span>
              </div>
            </div>
          </div>

          <div class="example-grid">
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.optionalBlocks') }}</span>
              <span class="pattern-col"><code>{{ '{authors}/<{series}/><{seriesIndex}. >{title}< ({year})>' }}</code></span>
              <span class="result-col"><code>Andy Weir/Project Hail Mary (2021).epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.seriesIndexFallback') }}</span>
              <span class="pattern-col"><code>{{ '<{seriesIndex}. >{title}< - {authors}>' }}</code></span>
              <span class="result-col"><code>Project Hail Mary - Andy Weir.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.bracketsFallback') }}</span>
              <span class="pattern-col"><code>{{ '<[{series}] >{title} - {authors}' }}</code></span>
              <span class="result-col"><code>Project Hail Mary - Andy Weir.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.seriesPunctuation') }}</span>
              <span class="pattern-col"><code>{{ '<{series}: >{title} by {authors}' }}</code></span>
              <span class="result-col"><code>Project Hail Mary by Andy Weir.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.yearPrefix') }}</span>
              <span class="pattern-col"><code>{{ '{authors}/{year}__{currentFilename}' }}</code></span>
              <span class="result-col"><code>Andy Weir/2021__project_hail_mary_final.epub</code></span>
            </div>
            <div class="example-row">
              <span class="pattern-label">{{ t('examples.subtitleFallback') }}</span>
              <span class="pattern-col"><code>{{ '{title}<: {subtitle}>' }}</code></span>
              <span class="result-col"><code>Project Hail Mary.epub</code></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</ng-container>
