<div class="metadata-settings">
  <div class="settings-card">
    <div class="section-header">
      <h3 class="section-title">
        <i class="pi pi-cloud"></i>
        Metadata Providers
      </h3>
      <p class="section-description">
        Configure which online sources to use for fetching book metadata. Enable providers and set up their API tokens or cookies to access richer book information.
      </p>
    </div>

    <div class="section-body">
      <div class="configurable-providers-section">
        <h4 class="provider-group-title">Providers with Configuration</h4>

        <div class="configurable-providers-list">
          <div class="setting-item">
            <div class="setting-header">
              <p-toggleswitch [(ngModel)]="amazonEnabled"></p-toggleswitch>
              <label class="setting-label">Amazon</label>
            </div>
            @if (amazonEnabled) {
              <div class="setting-options">
                <div class="config-field">
                  <label class="config-label">Region</label>
                  <p-select
                    [options]="amazonDomains"
                    [(ngModel)]="selectedAmazonDomain"
                    placeholder="Select Domain"
                    class="config-select">
                  </p-select>
                </div>
                <div class="config-field">
                  <div class="config-label-row">
                    <label class="config-label">Cookie (Optional, but highly recommended)</label>
                    <app-external-doc-link docType="amazonCookie"></app-external-doc-link>
                  </div>
                  <p class="config-description">Providing your Amazon session cookie allows the app to access richer book metadata and bypass rate limits.</p>
                  <input
                    type="text"
                    pInputText
                    placeholder="Paste your Amazon cookie"
                    [(ngModel)]="amazonCookie"
                    class="config-input"/>
                </div>
              </div>
            }
          </div>

          <div class="setting-item">
            <div class="setting-header">
              <p-toggleswitch [(ngModel)]="googleEnabled"></p-toggleswitch>
              <label class="setting-label">Google Books</label>
            </div>
            @if (googleEnabled) {
              <div class="setting-options">
                <div class="config-field">
                  <label class="config-label">Language Restriction</label>
                  <p-select
                    [options]="googleLanguages"
                    [(ngModel)]="selectedGoogleLanguage"
                    [showClear]="!!selectedGoogleLanguage"
                    placeholder="Select Language"
                    class="config-select">
                  </p-select>
                </div>
                <div class="config-field">
                  <label class="config-label">API Key (Optional)</label>
                  <p class="config-description">Providing a Google Books API key increases rate limits and improves reliability.</p>
                  <input
                    type="text"
                    pInputText
                    placeholder="Enter Google Books API key"
                    [(ngModel)]="googleApiKey"
                    class="config-input"/>
                </div>
              </div>
            }
          </div>

          <div class="setting-item">
            <div class="setting-header">
              <p-toggleswitch
                [(ngModel)]="hardcoverEnabled"
                [disabled]="!hardcoverToken">
              </p-toggleswitch>
              <label class="setting-label">Hardcover</label>
            </div>
            <div class="setting-options">
              <div class="config-field">
                <div class="config-label-row">
                  <label class="config-label">API Token</label>
                  <app-external-doc-link docType="hardcover"></app-external-doc-link>
                </div>
                <input
                  type="text"
                  pInputText
                  placeholder="Enter Hardcover API token"
                  [(ngModel)]="hardcoverToken"
                  (ngModelChange)="onTokenChange($event)"
                  class="config-input"/>
              </div>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-header">
              <p-toggleswitch [(ngModel)]="comicvineEnabled"></p-toggleswitch>
              <label class="setting-label">Comic Vine</label>
            </div>
            @if (comicvineEnabled) {
              <div class="setting-options">
                <div class="config-field">
                  <label class="config-label">API Token</label>
                  <input
                    type="text"
                    pInputText
                    placeholder="Enter Comic Vine API token"
                    [(ngModel)]="comicvineToken"
                    (ngModelChange)="onComicTokenChange($event)"
                    class="config-input"/>
                </div>
              </div>
            }
          </div>

          <div class="setting-item">
            <div class="setting-header">
              <p-toggleswitch [(ngModel)]="audibleEnabled"></p-toggleswitch>
              <label class="setting-label">Audible</label>
            </div>
            @if (audibleEnabled) {
              <div class="setting-options">
                <div class="config-field">
                  <label class="config-label">Region</label>
                  <p-select
                    [options]="audibleDomains"
                    [(ngModel)]="selectedAudibleDomain"
                    placeholder="Select Domain"
                    class="config-select">
                  </p-select>
                </div>
              </div>
            }
          </div>
        </div>
      </div>

      <div class="simple-providers-section">
        <h4 class="provider-group-title">Ready-to-Use Providers</h4>

        <div class="simple-providers-grid">
          <div class="setting-item simple-provider">
            <div class="setting-header">
              <p-toggleswitch [(ngModel)]="goodreadsEnabled"></p-toggleswitch>
              <label class="setting-label">Goodreads</label>
            </div>
          </div>

          <div class="setting-item simple-provider">
            <div class="setting-header">
              <p-toggleswitch [(ngModel)]="doubanEnabled"></p-toggleswitch>
              <label class="setting-label">Douban</label>
            </div>
          </div>

          <div class="setting-item simple-provider">
            <div class="setting-header">
              <p-toggleswitch [(ngModel)]="lubimyCzytacEnabled"></p-toggleswitch>
              <label class="setting-label">Lubimyczytac</label>
            </div>
          </div>

          <div class="setting-item simple-provider">
            <div class="setting-header">
              <p-toggleswitch [(ngModel)]="ranobedbEnabled"></p-toggleswitch>
              <label class="setting-label">Ranobedb</label>
            </div>
          </div>
        </div>
      </div>

      <div class="setting-actions">
        <p-button label="Save Configurations" icon="pi pi-save" severity="success" [outlined]="true" (click)="saveSettings()"></p-button>
      </div>
    </div>
  </div>
</div>
