<div class="reading-survival-container">
  <div class="chart-header">
    <div class="chart-title">
      <h3>
        <i class="pi pi-chart-line reading-survival-icon"></i>
        Reading Survival Curve
        <i class="pi pi-question-circle chart-info-icon"
           pTooltip="Inspired by survival analysis: starting from all books you've begun reading, this curve shows what fraction made it to each progress milestone. A steep drop at a threshold reveals where you tend to abandon books. The 'danger zone' highlights the steepest single drop-off point."
           tooltipPosition="bottom"
           tooltipStyleClass="chart-info-tooltip"
           [appendTo]="'body'"></i>
      </h3>
      <p class="chart-description">Of books started, what percentage reached each progress threshold</p>
    </div>
  </div>

  @if (totalStarted > 0) {
    <div class="stats-row">
      <div class="stat-card">
        <span class="stat-value">{{ totalStarted }}</span>
        <span class="stat-label">Started</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ completionRate }}%</span>
        <span class="stat-label">Completion Rate</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ medianDropout }}</span>
        <span class="stat-label">Median Dropout</span>
      </div>
      <div class="stat-card danger">
        <span class="stat-value">{{ dangerZoneRange }}</span>
        <span class="stat-subtitle">{{ dangerZoneDrop }}</span>
        <span class="stat-label">Danger Zone</span>
      </div>
    </div>
  }

  <div class="chart-wrapper">
    <canvas baseChart
            [data]="(chartData$ | async) ?? {labels: [], datasets: []}"
            [options]="chartOptions"
            [type]="chartType">
    </canvas>
  </div>

  @if (totalStarted === 0) {
    <div class="no-data-message">
      <i class="pi pi-info-circle"></i>
      <p>No books with reading progress found.</p>
      <small>Start reading some books to see your survival curve.</small>
    </div>
  }
</div>
